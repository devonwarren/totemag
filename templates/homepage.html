{% extends "base.html" %}

{% block content %}

        <section id="grid" data-category="{{ category.slug }}">

        {% if category %}
        <center><div class="category-tag">{{ category.name }}</div></center>
        {% endif %}


        {% for post in articles %}    
            <div class="item count-{{ forloop.counter }}" >
                <a onclick="loadArticle('{{ post.slug }}', {{ forloop.counter }})" title="{{ post.title }}">
                    <img src="{{ post.image_thumbnail.url }}">
                </a>
                
                <a onclick="loadArticle('{{ post.slug }}', {{ forloop.counter }})" title="{{ post.title }}" class="itemExcerpt">
                    {{ post.title }}
                </a>
            </div>
        {% empty %}
            <center><h3>Sorry, it looks like we don't have any articles on this section yet</h3></center>
        {% endfor %}
    
        </section>

        <div class="clearfix"></div>
    
        {% if has_more %}
        <section id="load" data-page="2">
        
            <a onclick="moreArticles()">Load More</a>
        
        </section>
        {% endif %}
        
        
        <section id="ad">
        {% load staticfiles %}
            <a href="http://sassmagazine.com"><img src="{% static "images/ads/sass_banner_468x60.jpg" %}" alt="SASS Banner Advertisement"></a>
        </section>
        <!-- End Footer Ad -->


{% endblock %}

{% block styleload %}
<link rel="stylesheet" type="text/css" href="{% static "css/slick.css" %}"/>
<link rel="stylesheet" type="text/css" href="{% static "css/slick-theme.css" %}"/>
{% endblock %}

{% block scriptload %}
<script type="text/javascript" src="{% static "js/slick.min.js" %}"></script>
<script type="text/javascript">

    function loadArticle(slug, count) {
        $.get( "api/article/" + slug, function( data ) {
            $('#grid .container').remove();
            var row = $('.count-' + Math.ceil(( count /4.0))*4)
            if (row.length != 0) {
                $(data).insertAfter(row);
            } else {
                $(data).appendTo($('#grid'));
            }
            startSlideshows();
        });
    }

    function moreArticles() {
        var page = parseInt($('#load').attr('data-page'));
        $('#load').attr('data-page', page + 1);
        var category = $('#grid').attr('data-category');
        if (category != '') {
            var articles = $.getJSON("api/article_list/" + category + '/' + page, function(data) { addArticles(data); }).fail(function() {
                    $('#load').hide();
                });
        } else {
            var articles = $.getJSON("api/article_list/" + page, function(data) { addArticles(data); }).fail(function() {
                    $('#load').hide();
                });
        }
    }

    function addArticles(list) {
        var grid = $('#grid');
        $.each(list, function (key, article) {

            grid.append('<div class="item"><a href="' + article.url +
                '" title="' + article.title + '"><img src="' +
                article.thumbnail_url + '"></a><a href="' + article.url +
                '" title="' + article.title +
                '" class="itemExcerpt">' + article.title + '</a></div>')
        });
    }

     function startSlideshows() {
        $('.slideshow').slick({
            dots: true,
            infinite: true,
            speed: 500,
            slidesToShow: 1,
            slidesToScroll: 1
        });
    }
</script>
{% endblock %}